<?xml version="1.0" encoding="UTF-8"?>
<odoo>

<template id="invoice_report_template">
<t t-name="ft_backend.invoice_report_template">

    <t t-foreach="docs" t-as="o">
        <t t-call="web.html_container">
            <t t-call="web.external_layout">

                <style>
                    table {
                        border-collapse: collapse;
                        width: 100%;
                    }
                    td, th {
                        border: 1px solid #000;
                        padding: 8px 8px;
                         padding-right: 12px;
                        line-height: 1.5;
                        vertical-align: middle;
                    }
                    th {
                        font-weight: bold;
                    }
                    .red {
                        background-color: #C72300;
                        color: #000;
                    }
                    .center {
                        text-align: center;
                    }
                    .right {
                        text-align: right;
                        padding-right: 12px;
                    }
                    .total-amount {
                        min-width: 100px;
                        padding-right: 14px !important;
                        text-align: right;
                    }

                    .label-cell {
                        padding-left: 12px !important;
                    }

                    .label-cell-righ {
                        padding-right: 12px !important;
                    }

                    .vat-invoice-title {
                        text-align: center;
                        font-weight: bold;
                        font-style: italic;
                        text-decoration: underline;
                        font-size: 16px;
                        line-height: 1.1;
                    }

                    .company-main-title {
                        text-align: center;
                        margin-bottom: 4px;
                        border: 0 !important;
                        white-space: nowrap;
                    }

                    .company-main-title-en {
                        display: inline-block;
                        vertical-align: bottom;
                        width: 49%;
                        text-align: center;
                        color: #C72300;
                        font-weight: 700;
                        font-size: 28px;
                        text-decoration: underline;
                        line-height: 1.1;
                        white-space: nowrap;
                    }

                    .company-main-title-en .title-suffix {
                        color: #000;
                    }

                    .company-main-title-ar {
                        display: inline-block;
                        vertical-align: bottom;
                        width: 49%;
                        direction: rtl;
                        unicode-bidi: isolate;
                        text-align: center;
                        color: #000;
                        font-weight: 700;
                        font-size: 28px;
                        line-height: 1.1;
                        white-space: nowrap;
                    }

                    .rtl-text {
                        direction: rtl;
                        text-align: right;
                        unicode-bidi: isolate;
                    }

                    .red-black {
                        background-color: #C72300;
                        color: #000;
                    }

                    .compact-cell {
                        line-height: 1.35;
                    }

                    .details-table {
                        table-layout: fixed;
                        width: 100%;
                    }

                    .details-table th,
                    .details-table td {
                        width: 50%;
                        overflow-wrap: anywhere;
                        word-break: break-word;
                    }

                    .bank-details-section {
                        page-break-inside: avoid !important;
                        break-inside: avoid-page !important;
                        display: block;
                    }

                    .bank-details-section .bank-details-box {
                        page-break-inside: avoid !important;
                        break-inside: avoid-page !important;
                    }

                    .bank-details-table {
                        border-collapse: collapse;
                        border: none !important;
                        table-layout: fixed;
                        width: 100%;
                    }

                    .bank-details-table td {
                        border: none !important;
                        padding: 0 8px 0 0 !important;
                        vertical-align: top !important;
                    }

                    .bank-details-bank {
                        width: 40%;
                    }

                    .bank-details-address {
                        width: 30%;
                    }

                    .bank-details-qr {
                        width: 30%;
                    }

                    .bank-details-table td:last-child {
                        padding-right: 0 !important;
                    }

                    .bank-details-box {
                        border: 1px solid #666;
                        box-sizing: border-box;
                        width: 100%;
                        height: 194px;
                        padding: 8px 10px;
                        line-height: 1.35;
                    }

                    .bank-details-text {
                        display: flex;
                        flex-direction: column;
                        justify-content: space-between;
                        font-size: 15px;
                        line-height: 1.6;
                    }

                    .bank-details-text strong {
                        display: block;
                        font-size: 18px;
                        line-height: 1.2;
                    }

                    .bank-details-text .bank-line {
                        display: block;
                    }

                    .bank-details-bank .bank-details-box {
                        border-right: 0;
                    }

                    .bank-details-box-qr {
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        padding: 6px;
                    }

                    .bank-details-qr-image {
                        display: block;
                        width: 180px;
                        height: 180px;
                    }

                </style>

                <div class="page" style="font-size:12px;">
                    <t t-set="company_partner" t-value="o.company_id.partner_id"/>
                    <t t-set="customer_partner" t-value="o.partner_id"/>

                    <t t-set="company_name_ar"
                       t-value="(company_partner._fields.get('name_arabic') and company_partner.name_arabic)
                           or (company_partner._fields.get('name_ar') and company_partner.name_ar)
                           or (company_partner._fields.get('arabic_name') and company_partner.arabic_name)
                           or (o.company_id._fields.get('name_arabic') and o.company_id.name_arabic)
                           or (o.company_id._fields.get('name_ar') and o.company_id.name_ar)
                           or ''"/>
                    <t t-set="customer_name_ar"
                       t-value="(customer_partner._fields.get('name_arabic') and customer_partner.name_arabic)
                           or (customer_partner._fields.get('name_ar') and customer_partner.name_ar)
                           or (customer_partner._fields.get('arabic_name') and customer_partner.arabic_name)
                           or ''"/>

                    <t t-set="company_address_ar_full"
                       t-value="(company_partner._fields.get('address_arabic') and company_partner.address_arabic)
                           or (company_partner._fields.get('contact_address_arabic') and company_partner.contact_address_arabic)
                           or ''"/>
                    <t t-set="company_street_ar"
                       t-value="(company_partner._fields.get('street_arabic') and company_partner.street_arabic)
                           or (company_partner._fields.get('street_ar') and company_partner.street_ar)
                           or ''"/>
                    <t t-set="company_street2_ar"
                       t-value="(company_partner._fields.get('street2_arabic') and company_partner.street2_arabic)
                           or (company_partner._fields.get('street2_ar') and company_partner.street2_ar)
                           or ''"/>
                    <t t-set="company_city_ar"
                       t-value="(company_partner._fields.get('city_arabic') and company_partner.city_arabic)
                           or (company_partner._fields.get('city_ar') and company_partner.city_ar)
                           or ''"/>
                    <t t-set="company_zip_ar"
                       t-value="(company_partner._fields.get('zip_arabic') and company_partner.zip_arabic)
                           or (company_partner._fields.get('zip_ar') and company_partner.zip_ar)
                           or ''"/>
                    <t t-set="company_country_ar"
                       t-value="(company_partner._fields.get('country_arabic') and company_partner.country_arabic)
                           or (company_partner.country_id and company_partner.country_id._fields.get('name_arabic') and company_partner.country_id.name_arabic)
                           or ''"/>
                    <t t-set="company_address_ar"
                       t-value="company_address_ar_full or '، '.join([v for v in [company_street_ar, company_street2_ar, company_city_ar, company_zip_ar, company_country_ar] if v])"/>

                    <t t-set="customer_address_ar_full"
                       t-value="(customer_partner._fields.get('address_arabic') and customer_partner.address_arabic)
                           or (customer_partner._fields.get('contact_address_arabic') and customer_partner.contact_address_arabic)
                           or ''"/>
                    <t t-set="customer_street_ar"
                       t-value="(customer_partner._fields.get('street_arabic') and customer_partner.street_arabic)
                           or (customer_partner._fields.get('street_ar') and customer_partner.street_ar)
                           or ''"/>
                    <t t-set="customer_street2_ar"
                       t-value="(customer_partner._fields.get('street2_arabic') and customer_partner.street2_arabic)
                           or (customer_partner._fields.get('street2_ar') and customer_partner.street2_ar)
                           or ''"/>
                    <t t-set="customer_city_ar"
                       t-value="(customer_partner._fields.get('city_arabic') and customer_partner.city_arabic)
                           or (customer_partner._fields.get('city_ar') and customer_partner.city_ar)
                           or ''"/>
                    <t t-set="customer_zip_ar"
                       t-value="(customer_partner._fields.get('zip_arabic') and customer_partner.zip_arabic)
                           or (customer_partner._fields.get('zip_ar') and customer_partner.zip_ar)
                           or ''"/>
                    <t t-set="customer_country_ar"
                       t-value="(customer_partner._fields.get('country_arabic') and customer_partner.country_arabic)
                           or (customer_partner.country_id and customer_partner.country_id._fields.get('name_arabic') and customer_partner.country_id.name_arabic)
                           or ''"/>
                    <t t-set="customer_address_ar"
                       t-value="customer_address_ar_full or '، '.join([v for v in [customer_street_ar, customer_street2_ar, customer_city_ar, customer_zip_ar, customer_country_ar] if v])"/>

                    <t t-set="company_cr_no"
                       t-value="o.company_id.company_registry or company_partner.company_registry or ''"/>
                    <t t-set="company_cr_no_ar"
                       t-value="(o.company_id._fields.get('company_registry_arabic') and o.company_id.company_registry_arabic)
                           or (company_partner._fields.get('company_registry_arabic') and company_partner.company_registry_arabic)
                           or (o.company_id._fields.get('company_registry_ar') and o.company_id.company_registry_ar)
                           or (company_partner._fields.get('company_registry_ar') and company_partner.company_registry_ar)
                           or company_cr_no"/>
                    <t t-set="company_vat_ar"
                       t-value="(company_partner._fields.get('vat_arabic') and company_partner.vat_arabic)
                           or company_partner.vat
                           or ''"/>
                    <t t-set="customer_vat_ar"
                       t-value="(customer_partner._fields.get('vat_arabic') and customer_partner.vat_arabic)
                           or customer_partner.vat
                           or ''"/>

                    <div class="company-main-title" style="border:0 !important;">
                        <span class="company-main-title-en">ENERGY SERVICES <span class="title-suffix">LTD. CO.</span></span>
                        <span class="company-main-title-ar">شركة الخدمات الطاقة المحدوده</span>
                    </div>
                     <br/>
                    <div class="vat-invoice-title" style="margin-bottom:4px; border:none !important;">
                        VAT Invoice / فاتورة ضريبية
                    </div>

                    <table class="details-table" style="margin-top:4px;">
                        <colgroup>
                            <col style="width:50%;"/>
                            <col style="width:50%;"/>
                        </colgroup>
                        <tr>
                            <th class="red-black center compact-cell">
                                <t t-esc="company_partner.name or ''"/>
                                <t t-if="company_name_ar">
                                    <br/>
                                    <span class="rtl-text"><t t-esc="company_name_ar"/></span>
                                </t>
                            </th>
                            <th class="red-black center compact-cell">
                                <t t-esc="customer_partner.name or ''"/>
                                <t t-if="customer_name_ar">
                                    <br/>
                                    <span class="rtl-text"><t t-esc="customer_name_ar"/></span>
                                </t>
                            </th>
                        </tr>
                        <tr>
                            <td class="label-cell compact-cell">
                                <t t-esc="company_partner.street or ''"/>
                                <t t-if="company_partner.street2">
                                    , <t t-esc="company_partner.street2"/>
                                </t>
                                <t t-if="company_partner.city">
                                    , <t t-esc="company_partner.city"/>
                                </t>
                                <t t-if="company_partner.zip">
                                    , <t t-esc="company_partner.zip"/>
                                </t>
                                <t t-if="company_partner.country_id">
                                    , <t t-esc="company_partner.country_id.name"/>
                                </t>
                                <t t-if="company_address_ar">
                                    <br/>
                                    <span class="rtl-text"><t t-esc="company_address_ar"/></span>
                                </t>
                            </td>
                            <td class="label-cell compact-cell">
                                <t t-esc="customer_partner.street or ''"/>
                                <t t-if="customer_partner.street2">
                                    , <t t-esc="customer_partner.street2"/>
                                </t>
                                <t t-if="customer_partner.city">
                                    , <t t-esc="customer_partner.city"/>
                                </t>
                                <t t-if="customer_partner.zip">
                                    , <t t-esc="customer_partner.zip"/>
                                </t>
                                <t t-if="customer_partner.country_id">
                                    , <t t-esc="customer_partner.country_id.name"/>
                                </t>
                                <t t-if="customer_address_ar">
                                    <br/>
                                    <span class="rtl-text"><t t-esc="customer_address_ar"/></span>
                                </t>
                            </td>
                        </tr>
                        <tr>
                            <td class="label-cell compact-cell">
                                C.R. No:
                                 <t t-esc="o.company_id.l10n_sa_edi_additional_identification_number or '-'"/><br/>
                                <span class="rtl-text">رقم السجل التجاري:
                                    <t t-esc="company_cr_no_ar or '-'"/>
                                </span>
                            </td>
                            <td></td>
                        </tr>
                        <tr>
                            <td class="label-cell compact-cell">
                                VAT No:
                                <t t-esc="company_partner.vat or '-'"/><br/>
                                <span class="rtl-text">الرقم الضريبي:
                                    <t t-esc="company_vat_ar or '-'"/>
                                </span>
                            </td>
                            <td class="label-cell compact-cell">
                                Customer VAT No:
                                <t t-esc="customer_partner.vat or '-'"/><br/>
                                <span class="rtl-text">الرقم الضريبي للعميل:
                                    <t t-esc="customer_vat_ar or '-'"/>
                                </span>
                            </td>
                        </tr>
                    </table>
                    <br/>


                    <!-- ================= INVOICE INFO ================= -->
                    <table>
                        <tr>
                            <td class="red label-cell">Invoice No.<br/>رقم الفاتورة</td>
                            <td><t t-esc="o.name"/></td>
                            <td class="red label-cell">Invoice Date<br/>تاريخ الفاتورة</td>
                            <td><t t-esc="o.invoice_date"/></td>
                        </tr>
                        <tr>
                            <td class="red label-cell">PO No.<br/>رقم أمر الشراء</td>
                            <td><t t-esc="o.ref or ''"/></td>
                            <td class="red label-cell">Payment Terms<br/>شروط الدفع</td>
                            <td><t t-esc="o.invoice_payment_term_id.name"/></td>
                        </tr>
                    </table>

                    <br/>

                    <!-- ================= LINE ITEMS ================= -->
                    <t t-set="currency_label" t-value="(o.currency_id and (o.currency_id.name or o.currency_id.symbol)) or 'USD'"/>
                    <t t-set="currency_ar_map" t-value="{'USD': 'دولار أمريكي', 'SAR': 'ريال سعودي', 'EUR': 'يورو', 'GBP': 'جنيه إسترليني', 'AED': 'درهم إماراتي', 'QAR': 'ريال قطري', 'KWD': 'دينار كويتي', 'BHD': 'دينار بحريني', 'OMR': 'ريال عماني', 'JOD': 'دينار أردني', 'EGP': 'جنيه مصري', 'INR': 'روبية هندية', 'PKR': 'روبية باكستانية'}"/>
                    <t t-set="currency_label_ar" t-value="currency_ar_map.get(currency_label, currency_label)"/>
                    <table>
                        <thead>
                            <tr class="red center">
                                <th style="width:5%;">L/I</th>
                                <th style="width:35%;">Description<br/>الوصف</th>
                                <th style="width:8%;">Qty<br/>الكمية</th>
                                <th style="width:10%;">UOM<br/>الوحدة</th>
                                <th style="width:12%;">Rental Days<br/>أيام التأجير</th>
                                <th style="width:15%;">Unit Price (<t t-esc="currency_label"/>)<br/>سعر الوحدة (<t t-esc="currency_label_ar"/>)</th>
                                <th style="width:15%;">Total Amount (<t t-esc="currency_label"/>)<br/>الإجمالي (<t t-esc="currency_label_ar"/>)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-set="sr" t-value="1"/>
                            <t t-foreach="o.invoice_line_ids" t-as="line">
                                <tr>
                                    <td class="center"><t t-esc="sr"/></td>
                                    <td><t t-esc="line.name"/></td>
                                    <td class="center"><t t-esc="line.quantity"/></td>
                                    <td class="center"><t t-esc="line.product_uom_id.name"/></td>
                                    <td class="center"><t t-esc="line.rental_days"/></td>
                                    <td class="right"><t t-esc="line.price_unit"/></td>
                                    <td class="right label-cell-righ"><t t-esc="line.price_subtotal"/></td>
                                </tr>
                                <t t-set="sr" t-value="sr + 1"/>
                            </t>
                        </tbody>
                    </table>

                    <br/>

                    <!-- ================= TOTALS ================= -->
                    <!-- ================= TOTALS ================= -->
                <table>
                    <colgroup>
                        <col style="width:80%;"/>
                        <col style="width:20%;"/>
                    </colgroup>

                    <!-- Total Excluding VAT -->
                    <tr>
                        <td>
                            <table width="100%" style="border:none;">
                                <tr>
                                    <td style="border:none; text-align:left;" class="label-cell">
                                        Total Excluding VAT
                                    </td>
                                    <td style="border:none; text-align:right; direction:rtl;">
                                        المجموع قبل الضريبة
                                    </td>
                                </tr>
                            </table>
                        </td>
                        <td class="total-amount">
                            <t t-esc="o.amount_untaxed"/>
                        </td>
                    </tr>

                    <!-- Total VAT 15% -->
                    <tr>
                        <td>
                            <table width="100%" style="border:none;">
                                <tr>
                                    <td style="border:none; text-align:left;" class="label-cell">
                                        Total VAT 15%
                                    </td>
                                    <td style="
                                        border:none;
                                        text-align:right;
                                        direction:rtl;
                                        unicode-bidi:isolate;
                                        width:50%;
                                    ">
                                        <span style="display:block;">
                                            مجموع ضريبة القيمة المضافة 
                                        </span>
                                    </td>
                                                    </tr>
                            </table>
                        </td>
                        <td class="total-amount">
                            <t t-esc="o.amount_tax"/>
                        </td>
                    </tr>

                    <!-- Total Amount -->
                    <tr>
                        <td>
                            <table width="100%" style="border:none;">
                                <tr>
                                    <td style="border:none; text-align:left;" class="label-cell">
                                        <strong>Total Amount</strong>
                                    </td>
                                    <td style="border:none; text-align:right; direction:rtl;">
                                        <strong>المجموع الإجمالي</strong>
                                    </td>
                                </tr>
                            </table>
                        </td>
                        <td class="total-amount">
                            <strong><t t-esc="o.amount_total"/></strong>
                        </td>
                    </tr>
                </table>


                    

                    <br/>

                    <!-- ================= BANK DETAILS ================= -->
                    <div class="bank-details-section" style="page-break-inside:avoid; break-inside:avoid-page;">
                        <table class="bank-details-table" width="100%">
                            <tr style="border:none !important;">
                                <td class="bank-details-bank">
                                    <div class="bank-details-box bank-details-text">
                                        <strong>BANK DETAILS</strong>
                                        <span class="bank-line">Bank: ARAB NATIONAL BANK</span>
                                        <span class="bank-line">Account Name: Energy Services LTD CO</span>
                                        <span class="bank-line">Account Number: 0108095378110018</span>
                                        <span class="bank-line">IBAN: SA0230400108095378110018</span>
                                    </div>
                                </td>
                                <td class="bank-details-address">
                                    <div class="bank-details-box bank-details-text">
                                        <span class="bank-line">Address: KING FAISAL STREET NORTH MURABA</span>
                                        <span class="bank-line">CITY: RIYADH</span>
                                        <span class="bank-line">ZIP: 11564</span>
                                        <span class="bank-line">COUNTRY: Saudi Arabia</span>
                                        <span class="bank-line">Swift Code: ARNBSARI</span>
                                    </div>
                                </td>
                                <td class="bank-details-qr">
                                    <t t-if="o._l10n_sa_is_legal() and o.l10n_sa_qr_code_str">
                                        <div class="bank-details-box bank-details-box-qr">
                                            <img
                                                t-att-src="'/report/barcode/?barcode_type=QR&amp;value=%s&amp;width=180&amp;height=180'
                                                    % quote_plus(o.l10n_sa_qr_code_str)"
                                                class="bank-details-qr-image"
                                            />
                                        </div>
                                    </t>
                                </td>
                            </tr>
                        </table>
                    </div>


                </div>

            </t>
        </t>
    </t>

</t>
</template>

</odoo>
